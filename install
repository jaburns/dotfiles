#!/usr/bin/env bash

case "$OSTYPE" in
    linux*)  os='linux'   ;;
    darwin*) os='osx'     ;;
    *)       os='windows' ;;
esac

if [[ "$1" == 'omni' ]]; then
    cd .vim/bundle/Omnisharp/server/OmniSharp
    if [[ "$os" == 'windows' ]]; then
        echo msbuild | cmd
        echo ""
    else
        xbuild
    fi
    exit 0
elif [[ "$1" == 'plugins' ]]; then
    git submodule update --init --recursive
    exit 0
fi

repo_dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

install () {
    if [[ "$1" == 'dir' ]]; then
        rm -rf "$HOME/$2"
        mkdir -p "$(dirname "$HOME/$2")"
        ln -s "$repo_dir/$2" "$HOME/$2"
    else
        rm -f "$HOME/$2"
        ln "$repo_dir/$2" "$HOME/$2"
    fi
    echo "Linking '$repo_dir/$2' -> '$HOME/$2'"
}

install dir  .vim
install file .ctags
install file .bashrc
install file .vimrc
install file .tmux.conf

if [[ "$os" == 'linux' ]]; then
    install file .Xmodmap
    install dir  .xmonad
elif [[ "$os" == 'osx' ]]; then
    install file .bash_profile
elif [[ "$os" == 'windows' ]]; then
    install file .minttyrc

    rm -rf "/cygdrive/c/Users/$(whoami)/vimfiles"
    rm -f /cygdrive/c/Users/$(whoami)/_vimrc
    rm -rf /cygdrive/c/Users/$(whoami)/vimfiles
    echo "mklink /h \"c:\\Users\\$(whoami)\\_vimrc\" \
                    \"C:\\cygwin\\home\\$(whoami)\\dotfiles\\.vimrc" | cmd
    echo "mklink /j \"c:\\Users\\$(whoami)\\vimfiles\" \
                    \"C:\\cygwin\\home\\$(whoami)\\dotfiles\\.vim\"" | cmd
    echo ""
fi
