#!/bin/bash

case "$OSTYPE" in
    linux*)  os='linux'   ;;
    darwin*) os='osx'     ;;
    *)       os='windows' ;;
esac

if [[ "$1" == 'omni' ]]; then
    cd .vim/bundle/Omnisharp/server/OmniSharp
    if [[ "$os" == 'windows' ]]; then
        echo msbuild | cmd
        echo ""
    else
        xbuild
    fi
    exit 0
fi

repo_dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

install () {
    if [[ "$1" == 'dir' ]]; then
        rm -rf "$HOME/$2"
        mkdir -p "$(dirname "$HOME/$2")"
        ln -s "$repo_dir/$2" "$HOME/$2"
    else
        rm -r "$HOME/$2"
        ln "$repo_dir/$2" "$HOME/$2"
    fi
    echo "Linking '$repo_dir/$2' -> '$HOME/$2'"
}

if [[ "$1" != 'light' ]]; then
    git submodule update --init --recursive
fi

install dir  .vim
install file .ctags
install file .bashrc
install file .tmux.conf

if [[ "$os" == 'linux' ]]; then
    install dir  .themes/jaburns
    install file .Xmodmap
fi

if [[ "$os" == 'windows' ]]; then

    install file .minttyrc

    rm -rf "/cygdrive/c/Users/$(whoami)/vimfiles"
    echo "mklink /j \"c:\\Users\\$(whoami)\\vimfiles\" \
                    \"C:\\cygwin\\home\\$(whoami)\\dotfiles\\.vim\"" | cmd
    echo ""
fi
